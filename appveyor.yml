# We only care about master for now.
branches:
    only:
        - master

# Do not build tags
skip_tags: true

#--------------------#
# Environment Config #
#--------------------#

image: Visual Studio 2017

matrix:
    fast_finish: true # Fail right away if something goes wrong.

#--------------#
# Build Config #
#--------------#

platform: x64

configuration: Install

before_build:
    - git submodule update --init SethCS
    - msbuild /t:restore Chaskis/Chaskis.sln

build:
    parallel: true
    project: Chaskis/Chaskis.sln
    publish_nuget: false
   
before_package:
    - choco pack .\Chaskis\Install\chocolatey\package\chaskis.nuspec
    - dotnet pack .\Chaskis\ChaskisCore\Chaskis.Core.csproj --no-build --configuration Release --output .\
   
#-------------#
# Test Config #
#-------------#

test:
    assemblies:
        - ChaskisTests.dll
        - CoreTests.dll
        - PluginTests.dll

notifications:
    - provider: Email
      to:
          - seth@shendrick.net
      subject: 'Chaskis Build {{status}}'


#-----------#
# Artifacts #
#-----------#

artifacts:
    - path: '*.nupkg'
    - path: '.\Chaskis\Install\windows\bin\x64\Release\*.msi'
